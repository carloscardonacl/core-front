<div class="row">
  <div class="col-md-12">
    <div class="card">
      <div class="card-header">
        <button style="margin-top:0 !important;" class="pull-right btn btn-info btn-sm ml-2"
          (click)="ModalActividad.show(); agregarEvento()"><i class="ti-plus"></i> Agregar Nuevo evento</button>
        <button style="margin-top:0 !important;" class="pull-right btn btn-primary btn-sm"
          (click)="ModalTipoActividad.show()"><i class="ti-plus"></i>Agregar Tipo Actividad</button>
        <h4>Calendario Actividades</h4>

      </div>

      <div class="card-body" style="padding-top:10px;">

        <div>
          <!-- <ng-fullcalendar (eventRender)="eventrender($event.detail)" #ucCalendar [options]="calendarOptions" (eventClick)="accionarEvento($event)" [eventsModel]="eventsModel" lang="es-us">
                      </ng-fullcalendar> -->
          <full-calendar #calendar defaultView="dayGridMonth" [header]="{
                        left: 'prevYear,prev,next,nextYear today',
                        center: 'title',
                        right: 'dayGridMonth,dayGridWeek,dayGridDay,listWeek'}" [plugins]="calendarPlugins"
            [eventResizableFromStart]="'true'" [eventLimit]="false" themeSystem='bootstrap'
            [weekends]="calendarWeekends" [bootstrapFontAwesome]="true" deepChangeDetection="true"
            [events]="eventsModel" (eventClick)="accionarEvento( $event)" locale="es">
          </full-calendar>
          <!--
                    (dateClick)="openModal(content, $event)" -->
        </div>

      </div>

    </div>
  </div>
</div>


<!-- <swal #alertSwal title="" text="" type=""></swal> -->

<!--modal para guardar tipo actividad-->
<app-modal-basic [dialogClass]="'modal-md'" id="ModalTipoActividad" #ModalTipoActividad>
  <div class="app-modal-header">
    <h4 class="modal-title">Agregar Tipo Actividad</h4>
    <button type="button" class="close basic-close" (click)="CerrarModalTipo()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>

  <div class="app-modal-body">
    <form #FormActividad="ngForm">
      <div class="form-row">
        <div class="col-md-5">
          <div class="form-group">
            <label for="actividad">Nombre Tipo Actividad</label>
            <input type="text" name="name" ngModel id="actividad"
             required minlength="0" maxlength="30"
              class="form-control form-control-sm" >
          </div>

        </div>
        <div class="col-md-2">
          <label for="actividad">Color</label>
          <input type="color" name="color" ngModel id="actividad" required
          class="form-control form-control-sm"
            >
        </div>
        <div class="col-md-4 mt-3">
          <button class="btn btn-outline-primary btn-sm rounded"
          [disabled]="FormActividad.invalid"
          (click)="GuardarTipoActividad(FormActividad);"><i
              class="ti-save mr-2"></i>Guardar Tipo
          </button>
        </div>

      </div>
      <hr />
    </form>
    <div class="form-row">
      <div class="col-md-12">
        <h6 class="modal-title mt-3">Tipo Actividades</h6><br>
        <table class="table table-striped table-hover">
          <thead>
            <tr>
              <th class="text-left fs-3">Nombre</th>
              <th class="text-left fs-3">Color</th>
              <th class="text-right fs-3 mr-2">Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let Tipos of TiposActividad">
              <td>
                {{Tipos.name}}
              </td>
              <td>
                {{Tipos.color}}
              </td>
              <div class="d-flex justify-content-end mb-2">
                <td>
                  <div *ngIf="Tipos.state != 'Activado' ">
                    <button class="activar btn btn-sm btn-outline-success" (click)="CambiarEstadoTipo(Tipos)">
                      Activar
                    </button>
                  </div>
                  <div *ngIf="Tipos.Estado == 'Activado' ">
                    <button class="btn btn-sm btn-outline-danger" (click)="CambiarEstadoTipo(Tipos)">
                      Desactivar
                    </button>
                  </div>
                </td>
              </div>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</app-modal-basic>


<!--modal para crear evento-->
<app-modal-basic [dialogClass]="'modal-lg'" id="ModalActividad" #ModalActividad>
  <div class="app-modal-header">
    <h4 class="modal-title">Nueva Actividad</h4>
    <button type="button" class="close basic-close">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="app-modal-body">
    <form #FormActividad="ngForm">
      <div class="form-row">
        <div class="col-md-12">
          <div class="form-group">
            <label for="actividad">Nombre Actividad</label>
            <input type="text" name="Actividad" id="actividad"
             [readonly]="ver == 1" required minlength="0"
              maxlength="30" class="form-control form-control-sm"
              [(ngModel)]="ActividadModel.Actividad_Recursos_Humanos">
          </div>
        </div>

      </div>

      <div class="form-row">
        <div class="col-md-4">
          <div class="form-group">
            <label for="tipo_actividad">Tipo Actividad</label>
            <select class="otra form-control form-control-sm" name="rrhh_activity_type_id" id="tipo_actividad"
              [disabled]="ver == 1" [(ngModel)]="ActividadModel.Id_Tipo_Actividad_Recursos_Humanos" required>
              <option value="" selected>Seleccione tipo</option>
              <option *ngFor="let ta of TiposActividad" [value]="ta.id">
                {{ta.name}}
              </option>
            </select>
          </div>
        </div>

        <div class="col-md-4">
          <div class="form-group">
            <label for="fechai">Fecha Inicio</label>
            <input type="datetime-local" class="otra form-control form-control-sm" [readonly]="ver ? 1 : ''" required
              name="Fecha_Inicio" id="fechai" [(ngModel)]="ActividadModel.Fecha_Inicio">
          </div>
        </div>

        <div class="col-md-4">
          <div class="form-group">
            <label for="fechaf">Fecha Fin</label>
            <input type="datetime-local" class="otra form-control form-control-sm" [readonly]="ver ? 1 : ''" required
              name="Fecha_Fin" id="fechaf" [(ngModel)]="ActividadModel.Fecha_Fin">
          </div>
        </div>

        <div class="col-md-12">
          <div class="form-group">
            <label for="fechaf">Detalles</label>
            <input type="text" class="otra form-control form-control-sm" [readonly]="ver ? 1 : ''" required
              name="Detalles" id="Detalles" [(ngModel)]="ActividadModel.Detalles">
          </div>
        </div>
      </div>

      <div class="form-row">
        <div class="col-md-6">
          <div class="form-group">
            <label>Grupo (*)</label>
              <ng-select  [(ngModel)]="ActividadModel.Id_Grupo"   name="Grupo"  (change)="getDependencies($event.value)"
                [items]="groups" bindLabel="text" required bindValue="value" loadingText="loading" ngDefaultControl>
              </ng-select>

          </div>
        </div>

        <div class="col-md-6">
          <div class="form-group">
            <label>Dependencia (*)</label>
              <ng-select
              required
              name="Dependencia" [(ngModel)]="ActividadModel.Id_Dependencia"
              [(ngModel)]="ActividadModel.Id_Dependencia" (change)="Dependencia_Cargo($event.value)"
              [items]="dependencies" bindLabel="text" bindValue="value" loadingText="loading" ngDefaultControl>
            </ng-select>
          </div>
        </div>

      </div>


      <div class="form-row">
        <div class="form-group col-md-10 ml-1">
          <label>Funcionarios (*)</label>
          <ng-select [ngClass]="'ng-select' " name="label" [items]="Funcionarios" bindLabel="text"
          bindValue="value"
            [multiple]="true" [(ngModel)]="ActividadModel.Funcionario_Asignado">
          </ng-select>
        </div>
        <div *ngIf="ver ? 1 : '' " class=" form-group col-md-5 ml-1 rounded ">
          <table class="table table-striped table-hover ">
            <thead>
              <tr>
                <th class="text-left ">Funcionarios Asignados</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let fun of FuncionariosSele ">
                <td>
                  {{fun.Nombres}}
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

    </form>
    <div class="modal-footer">
      <div *ngIf="ver ? 1 : '' " class="text-right ">
        <button class="btn btn-outline-primary btn-sm rounded" style="display:flex; align-items:center;"
          [disabled]="!FormActividad.valid"
          [swal]="{title : '¿Está Seguro?', text: 'Se dispone a guardar esta actividad' , type : 'warning', showCancelButton : true , confirmButtonText: 'Si, Guardar',cancelButtonText: 'No, Comprobar!'}"
          (confirm)="GuardarActividad()"><i class="ti-save mr-2"></i> Guardar Actividad
        </button>
      </div>

    </div>
  </div>
</app-modal-basic>


<!--
<swal #confirmacionAccion [options]="alertOption"></swal>
<swal #deleteSwal title="" text="" type=""></swal> -->
<!--

<ng-template #rt_cliente let-r="result" let-t="term">
  <span class="f-9">
      {{r.Nombre}}
  </span>
</ng-template>
<ng-template #rt_funcionario let-r="result" let-t="term">
  <span class="f-9">
      {{r.Nombre}}
  </span>
</ng-template> -->
